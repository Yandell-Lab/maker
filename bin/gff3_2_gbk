#! /usr/bin/perl
use strict;
use Bio::SeqIO;
use Bio::Tools::GFF;
use File::Temp qw(tempfile);

my $usage = "
Usage:
      gff3_2_gbk <gff3_file>

      This script converts MAKER produced GFF3 files to GeneBank format.

";

my $file = shift;

if(! $file){
    print $usage;
    exit;
}

my ($TH, $t_file) = tempfile();

open(IN, "< $file");
my $ff = 0; #fasta flag
while(defined(my $line = <IN>)){
    $ff++ if(! $ff && $line =~ /\#\#FASTA/);

    if($ff || $line =~ /^\#/ || $line =~ /\tmaker\t/){
	print $TH $line;
    }
}
close(IN);
close($TH);

my $parser = new Bio::Tools::GFF(-gff_version => 3,
				 -file        => $t_file,
				 );

$parser->features_attached_to_seqs(1);
while(my $i = $parser->next_feature){}; #must unload all features first

my @seqs = $parser->get_seqs();

my $out = Bio::SeqIO->newFh(-format => 'GenBank');

my $val;
print $out $val while($val = shift @seqs);

unlink($t_file);
